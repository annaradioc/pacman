<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–£—Å–ø–µ—Ç—å –Ω–∞ –î–∏—Å–∫–æ—Ç–µ–∫—É üíÉ</title>
  <style>
    body { margin:0; overflow:hidden; font-family:sans-serif; background:#444; }
    #game { position:relative; width:100%; max-width:500px; height:700px; margin:0 auto; background:#666; border:5px solid #fff; overflow:hidden; touch-action: manipulation; }
    .lane { position:absolute; top:0; width:2px; height:100%; background:white; opacity:0.5; z-index:0; }
    .player { position:absolute; bottom:10px; left:200px; width:100px; text-align:center; font-size:60px; z-index:2; transition:left 0.1s; }
    .obstacle { position:absolute; width:100px; text-align:center; font-size:60px; top:0; z-index:1; color:black; }
    .note { position:absolute; width:100px; text-align:center; font-size:40px; top:0; z-index:1; color:yellow; }
    @keyframes fall { 0% { top:-60px; } 100% { top:720px; } }
    .falling { animation:fall linear forwards; }
    #message, #victory { position:absolute; top:50%; width:100%; text-align:center; color:white; font-size:30px; display:none; z-index:10; }
    #scoreboard { position:absolute; top:10px; left:10px; color:#fff; font-size:20px; z-index:10; }
    #restartBtn { display:none; position:absolute; top:70%; left:50%; transform:translateX(-50%); padding:10px 20px; font-size:18px; background:#fff; border:none; cursor:pointer; z-index:10; }
    .rave { animation:party 0.2s infinite alternate; }
    @keyframes party { 0% { background:#000; } 100% { background:#6600cc; } }
    #victoryEmoji { font-size:50px; margin-top:20px; display:flex; justify-content:center; flex-wrap:wrap; gap:10px; }
    .controls { display:none; position:absolute; bottom:0; width:100%; text-align:center; z-index:5; }
    .btn { font-size:40px; padding:10px 20px; margin:10px; background:#fff; border:none; border-radius:10px; }
    @media(max-width:600px){
      .controls { display:block; }
    }
  </style>
</head>
<body>
  <div id="game">
    <div class="player" id="player">üï∫</div>
    <div id="message">üò¢ –¢—ã –Ω–µ —É—Å–ø–µ–ª –Ω–∞ –¥–∏—Å–∫–æ—Ç–µ–∫—É!</div>
    <div id="victory">üéâ –¢—ã —É—Å–ø–µ–ª –Ω–∞ –¥–∏—Å–∫–æ—Ç–µ–∫—É! ü™©<br><div id="victoryEmoji">üï∫üíÉüé∂ü™©üî•üï∫üíÉüé∂</div></div>
    <div id="scoreboard">–ù–æ—Ç—ã: 0 | –£—Ä–æ–≤–µ–Ω—å: 1</div>
    <button id="restartBtn">üîÑ –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
    <div class="controls">
      <button class="btn" id="leftBtn">‚óÄÔ∏è</button>
      <button class="btn" id="rightBtn">‚ñ∂Ô∏è</button>
    </div>
  </div>

  <!-- –ê—É–¥–∏–æ -->
  <audio id="sfx-note" src="note.mp3" preload="auto"></audio>
  <audio id="sfx-fail" src="fail.mp3" preload="auto"></audio>
  <audio id="sfx-win" src="win.mp3" preload="auto"></audio>

  <script>
    const sfxNote = document.getElementById('sfx-note');
    const sfxFail = document.getElementById('sfx-fail');
    const sfxWin = document.getElementById('sfx-win');
    const game = document.getElementById('game');
    const player = document.getElementById('player');
    const message = document.getElementById('message');
    const victory = document.getElementById('victory');
    const scoreboard = document.getElementById('scoreboard');
    const restartBtn = document.getElementById('restartBtn');
    const leftBtn = document.getElementById('leftBtn');
    const rightBtn = document.getElementById('rightBtn');

    const step = 100, maxSteps = 5, winScore = 30;
    let playerX = 200, gameOver = false, score = 0, level = 1;
    let obstacleInterval = 600, fallSpeed = 2;
    let obstacleSpawner, noteSpawner;
    let recentObstacleLanes = [];

    for (let i = 1; i < maxSteps; i++) {
      const lane = document.createElement('div');
      lane.className = 'lane';
      lane.style.left = `${i * step}px`;
      game.appendChild(lane);
    }

    document.addEventListener('keydown', e => {
      if (gameOver) return;
      if (e.key === 'ArrowLeft' && playerX > 0) movePlayer(-step);
      if (e.key === 'ArrowRight' && playerX < (step * (maxSteps - 1))) movePlayer(step);
    });

    leftBtn.addEventListener('click', () => {
      if (gameOver) return;
      if (playerX > 0) movePlayer(-step);
    });

    rightBtn.addEventListener('click', () => {
      if (gameOver) return;
      if (playerX < (step * (maxSteps - 1))) movePlayer(step);
    });

    function movePlayer(delta) {
      playerX += delta;
      player.style.left = playerX + 'px';
    }

    function updateScoreboard() {
      scoreboard.textContent = `–ù–æ—Ç—ã: ${score} | –£—Ä–æ–≤–µ–Ω—å: ${level}`;
    }

    function createObstacle() {
      if (gameOver) return;
      const obs = document.createElement('div');
      obs.classList.add('obstacle', 'falling');
      obs.textContent = 'üè†';
      const lane = Math.floor(Math.random() * maxSteps);
      obs.style.left = `${lane * step}px`;
      obs.style.animationDuration = `${fallSpeed}s`;
      game.appendChild(obs);
      recentObstacleLanes.push(lane);
      if (recentObstacleLanes.length > 5) recentObstacleLanes.shift();
      const check = setInterval(() => {
        const top = obs.offsetTop, left = obs.offsetLeft;
        if (top > 600 && Math.abs(left - playerX) < step * 0.5) {
          clearInterval(check); sfxFail.play(); endGame(false);
        }
        if (top > 700) { clearInterval(check); obs.remove(); }
      }, 50);
    }

    function createNote() {
      if (gameOver) return;
      let lane, attempts = 0;
      do {
        lane = Math.floor(Math.random() * maxSteps);
        attempts++;
      } while (recentObstacleLanes.includes(lane) && attempts < 10);
      const note = document.createElement('div');
      note.classList.add('note', 'falling');
      note.textContent = 'üéµ';
      note.style.left = `${lane * step}px`;
      note.style.animationDuration = `${fallSpeed}s`;
      game.appendChild(note);
      const check = setInterval(() => {
        const top = note.offsetTop, left = note.offsetLeft;
        if (top > 600 && Math.abs(left - playerX) < step) {
          clearInterval(check); note.remove();
          score++; updateScoreboard();
          sfxNote.currentTime = 0; sfxNote.play();
          checkLevelUp(); checkWin();
        }
        if (top > 700) clearInterval(check) && note.remove();
      }, 50);
    }

    function checkLevelUp() {
      if (score % 10 === 0) {
        level++; updateScoreboard();
        fallSpeed = Math.max(0.3, fallSpeed - 0.2);
        obstacleInterval = Math.max(200, obstacleInterval - 80);
        resetSpawners();
      }
    }

    function checkWin() {
      if (score >= winScore) {
        sfxWin.play(); endGame(true);
      }
    }

    function endGame(win) {
      gameOver = true;
      clearInterval(obstacleSpawner); clearInterval(noteSpawner);
      document.querySelectorAll('.falling').forEach(el => el.style.animationPlayState = 'paused');
      if (win) {
        victory.style.display = 'block'; game.classList.add('rave');
      } else {
        message.style.display = 'block';
      }
      restartBtn.style.display = 'block';
    }

    function startSpawners() {
      obstacleSpawner = setInterval(createObstacle, obstacleInterval);
      noteSpawner = setInterval(createNote, obstacleInterval * 1.5);
    }

    function resetSpawners() {
      clearInterval(obstacleSpawner); clearInterval(noteSpawner);
      startSpawners();
    }

    function resetGame() {
      document.querySelectorAll('.obstacle, .note').forEach(el => el.remove());
      playerX = 200; player.style.left = '200px';
      gameOver = false; score = 0; level = 1;
      fallSpeed = 2; obstacleInterval = 600; recentObstacleLanes = [];
      message.style.display = 'none'; victory.style.display = 'none'; restartBtn.style.display = 'none';
      game.classList.remove('rave'); updateScoreboard();
      resetSpawners();
    }

    restartBtn.addEventListener('click', resetGame);
    updateScoreboard();
    startSpawners();
  </script>
</body>
</html>
