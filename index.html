<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ü–æ–ø–∞—Å—Ç—å –Ω–∞ –î–∏—Å–∫–æ—Ç–µ–∫—É üíÉ</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
    body {
      margin: 0;
      overflow: hidden;
      font-family: 'Press Start 2P', cursive;
      background: #222;
      color: #fff;
    }
    #game {
      position: relative;
      width: 100%;
      max-width: 500px;
      height: 700px;
      margin: 0 auto;
      background: #444;
      border: 5px solid #fff;
      overflow: hidden;
      touch-action: manipulation;
    }
    @media (min-width: 800px) {
      #game {
        height: 900px;
      }
    }
    .lane {
      position: absolute;
      top: 0;
      width: 2px;
      height: 100%;
      background: white;
      opacity: 0.5;
      z-index: 0;
    }
    .player {
      font-family: 'Segoe UI Emoji', 'Noto Color Emoji', 'Apple Color Emoji', sans-serif;
      position: absolute;
      left: 200px;
      top: 500px;
      width: 100px;
      text-align: center;
      font-size: 60px;
      z-index: 2;
      transition: left 0.1s, top 0.1s;
    }
    .obstacle {
      position: absolute;
      width: 100px;
      text-align: center;
      font-size: 60px;
      top: 0;
      z-index: 1;
      color: black;
    }
    .note {
      position: absolute;
      width: 100px;
      text-align: center;
      font-size: 40px;
      top: 0;
      z-index: 1;
      color: yellow;
    }
    @keyframes fall {
      0% { top: -60px; }
      100% { top: 920px; }
    }
    .falling {
      animation: fall linear forwards;
    }
    #message, #victory {
      position: absolute;
      top: 50%;
      width: 100%;
      text-align: center;
      color: white;
      font-size: 18px;
      display: none;
      z-index: 10;
    }
    #scoreboard {
      position: absolute;
      top: 10px;
      left: 10px;
      color: #ffdd00;
      font-size: 12px;
      z-index: 10;
    }
    #restartBtn {
      display: none;
      position: absolute;
      top: 70%;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px 20px;
      font-size: 14px;
      background: #fff;
      border: 2px solid #000;
      cursor: pointer;
      z-index: 10;
    }
    .rave {
      animation: party 0.2s infinite alternate;
    }
    @keyframes party {
      0% { background: #000; }
      100% { background: #6600cc; }
    }
    #victoryEmoji {
      font-size: 24px;
      margin-top: 20px;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
    }
    .controls {
      display: none;
      position: absolute;
      bottom: 75px;
      width: 100%;
      text-align: center;
      z-index: 5;
    }
    .btn {
      font-size: 28px;
      padding: 10px 20px;
      margin: 5px;
      background: #fff;
      border: 2px solid #000;
      border-radius: 5px;
      font-family: 'Press Start 2P', cursive;
    }
    #startScreen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #000;
      z-index: 999;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      font-family: 'Press Start 2P', cursive;
    }
    #startBtn {
      font-size: 14px;
      padding: 12px 24px;
      margin-top: 20px;
      background: #fff;
      border: 2px solid #000;
      font-family: 'Press Start 2P', cursive;
      cursor: pointer;
    }

    @media (max-width: 600px) {
      .controls {
        display: block;
        bottom: 90px;
      }
      .player {
        top: 450px;
      }
    }
  </style>
</head>
<body>
  <div id="startScreen">
    <p style="text-align:center;">üé∂ –°–æ–±–µ—Ä–∏ –Ω–æ—Ç–∫–∏, –∏–∑–±–µ–≥–∞–π –¥–æ–º–æ–≤! üé∂</p>
    <p style="text-align:center;">–£–ø—Ä–∞–≤–ª—è–π —Å—Ç—Ä–µ–ª–æ—á–∫–∞–º–∏ ‚óÄÔ∏è‚ñ∂Ô∏èüîºüîΩ</p>
    <button id="startBtn">‚ñ∂Ô∏è –í–ü–ï–†–Å–î –ù–ê –î–ò–°–ö–û–¢–ï–ö–£</button>
  </div>

  <div id="game">
    <div class="player" id="player">üï∫</div>
    <div id="message">üò¢ –¢—ã –Ω–µ –ø–æ–ø–∞–ª –Ω–∞ –¥–∏—Å–∫–æ—Ç–µ–∫—É!</div>
    <div id="victory">üéâ –¢—ã –ø–æ–ø–∞–ª –Ω–∞ –¥–∏—Å–∫–æ—Ç–µ–∫—É! ü™©<div id="victoryEmoji">üï∫üíÉüé∂ü™©üî•üï∫üíÉüé∂</div></div>
    <div id="scoreboard">–ù–æ—Ç—ã: 0 | –£—Ä–æ–≤–µ–Ω—å: 1</div>
    <button id="restartBtn">üîÑ –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
    <div class="controls">
      <button class="btn" id="leftBtn">‚óÄÔ∏è</button>
      <button class="btn" id="rightBtn">‚ñ∂Ô∏è</button>
    </div>
  </div>

  <audio id="sfx-note" src="–æ–ø.mp3" preload="auto"></audio>
  <audio id="sfx-fail" src="–±—É–º.mp3" preload="auto"></audio>
  <audio id="sfx-win" src="win.mp3" preload="auto"></audio>

  <script>
    const sfxNote = document.getElementById('sfx-note');
    const sfxFail = document.getElementById('sfx-fail');
    const sfxWin = document.getElementById('sfx-win');
    const game = document.getElementById('game');
    const player = document.getElementById('player');
    const message = document.getElementById('message');
    const victory = document.getElementById('victory');
    const scoreboard = document.getElementById('scoreboard');
    const restartBtn = document.getElementById('restartBtn');
    const leftBtn = document.getElementById('leftBtn');
    const rightBtn = document.getElementById('rightBtn');

    const step = 100, maxSteps = 5, winScore = 90;
    let playerX = 200, playerY = 500;
    let gameOver = false, score = 0, level = 1;
    let obstacleInterval = 600, fallSpeed = 2;
    let obstacleSpawner, noteSpawner;
    let recentObstacleLanes = [];
    const verticalStep = 40;
    const minY = 0;
    const maxY = game.offsetHeight - 100;

    for (let i = 1; i < maxSteps; i++) {
      const lane = document.createElement('div');
      lane.className = 'lane';
      lane.style.left = `${i * step}px`;
      game.appendChild(lane);
    }

    function movePlayer(deltaX = 0, deltaY = 0) {
      playerX += deltaX;
      playerY += deltaY;

      playerX = Math.max(0, Math.min(playerX, step * (maxSteps - 1)));
      playerY = Math.max(minY, Math.min(playerY, maxY));

      player.style.left = playerX + 'px';
      player.style.top = playerY + 'px';
    }

    document.addEventListener('keydown', e => {
      if (gameOver) return;
      if (e.key === 'ArrowLeft') movePlayer(-step, 0);
      if (e.key === 'ArrowRight') movePlayer(step, 0);
      if (e.key === 'ArrowUp') movePlayer(0, -verticalStep);
      if (e.key === 'ArrowDown') movePlayer(0, verticalStep);
    });

    leftBtn.addEventListener('click', () => {
      if (gameOver) return;
      movePlayer(-step, 0);
    });

    rightBtn.addEventListener('click', () => {
      if (gameOver) return;
      movePlayer(step, 0);
    });

    function updateScoreboard() {
      scoreboard.textContent = `–ù–æ—Ç—ã: ${score} | –£—Ä–æ–≤–µ–Ω—å: ${level}`;
    }

    function createObstacle() {
      if (gameOver) return;
      const obs = document.createElement('div');
      obs.classList.add('obstacle', 'falling');
      obs.textContent = 'üè†';
      const lane = Math.floor(Math.random() * maxSteps);
      obs.style.left = `${lane * step}px`;
      obs.style.animationDuration = `${fallSpeed}s`;
      game.appendChild(obs);
      recentObstacleLanes.push(lane);
      if (recentObstacleLanes.length > 5) recentObstacleLanes.shift();

      const check = setInterval(() => {
        const top = obs.offsetTop;
        const left = obs.offsetLeft;
        const overlapX = Math.abs(left - playerX) < 50;
        const overlapY = top + 40 > playerY && top < playerY + 100;

        if (overlapX && overlapY) {
          clearInterval(check);
          sfxFail.play();
          endGame(false);
        }

        if (top > 900) {
          clearInterval(check);
          obs.remove();
        }
      }, 30);
    }

    function createNote() {
      if (gameOver) return;
      let lane, attempts = 0;
      do {
        lane = Math.floor(Math.random() * maxSteps);
        attempts++;
      } while (recentObstacleLanes.includes(lane) && attempts < 10);
      const note = document.createElement('div');
      note.classList.add('note', 'falling');
      note.textContent = 'üéµ';
      note.style.left = `${lane * step}px`;
      note.style.animationDuration = `${fallSpeed}s`;
      game.appendChild(note);
      const check = setInterval(() => {
        const top = note.offsetTop;
        const left = note.offsetLeft;
        const overlapX = Math.abs(left - playerX) < 50;
        const overlapY = top + 40 > playerY && top < playerY + 100;
        if (overlapX && overlapY) {
          clearInterval(check); note.remove();
          score++; updateScoreboard();
          sfxNote.currentTime = 0; sfxNote.play();
          checkLevelUp(); checkWin();
        }
        if (top > 900) { clearInterval(check); note.remove(); }
      }, 30);
    }

    function checkLevelUp() {
      if (score > 0 && score % 10 === 0) {
        level++; updateScoreboard();
        fallSpeed = Math.max(0.3, fallSpeed - 0.2);
        obstacleInterval = Math.max(200, obstacleInterval - 80);
        resetSpawners();
      }
    }

    function checkWin() {
      if (score >= winScore) {
        sfxWin.play(); endGame(true);
      }
    }

    function endGame(win) {
      gameOver = true;
      clearInterval(obstacleSpawner); clearInterval(noteSpawner);
      document.querySelectorAll('.falling').forEach(el => el.style.animationPlayState = 'paused');
      if (win) {
        victory.style.display = 'block'; game.classList.add('rave');
      } else {
        message.style.display = 'block';
      }
      restartBtn.style.display = 'block';
    }

    function startSpawners() {
      obstacleSpawner = setInterval(createObstacle, obstacleInterval);
      noteSpawner = setInterval(createNote, obstacleInterval * 1.5);
    }

    function resetSpawners() {
      clearInterval(obstacleSpawner); clearInterval(noteSpawner);
      startSpawners();
    }

    function resetGame() {
      document.querySelectorAll('.obstacle, .note').forEach(el => el.remove());
      playerX = 200; playerY = 500;
      player.style.left = playerX + 'px';
      player.style.top = playerY + 'px';
      gameOver = false; score = 0; level = 1;
      fallSpeed = 2; obstacleInterval = 600; recentObstacleLanes = [];
      message.style.display = 'none'; victory.style.display = 'none'; restartBtn.style.display = 'none';
      game.classList.remove('rave'); updateScoreboard();
      resetSpawners();
    }

    restartBtn.addEventListener('click', resetGame);

    document.getElementById('startBtn').addEventListener('click', () => {
      document.getElementById('startScreen').style.display = 'none';
      updateScoreboard();
      startSpawners();
    });
  </script>
</body>
</html>

