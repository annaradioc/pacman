<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–£—Å–ø–µ—Ç—å –Ω–∞ –î–∏—Å–∫–æ—Ç–µ–∫—É üíÉ</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
    body {
      margin: 0; overflow: hidden;
      font-family: 'Press Start 2P', cursive;
      background: #222; color: #0f0;
      text-align: center;
    }
    #startScreen {
      position: absolute; top:0; left:0; width:100%; height:100%;
      background:#000; display:flex; flex-direction:column;
      justify-content:center; align-items:center; z-index:100;
    }
    button { font-family:inherit; color:#0f0; background:#111;
      border:2px solid #0f0; padding:12px 24px; margin:10px;
      cursor:pointer;
    }
    #game {
      display:none; position:relative;
      width:100%; max-width:500px; height:700px;
      margin:0 auto; background:#222; border:5px solid #0f0;
      touch-action:manipulation;
    }
    @media(min-width:800px){
      #game{height:900px;}
      @keyframes fall {100%{top:920px}}
    }
    .lane{position:absolute; top:0; width:2px; height:100%; background:#0f0; opacity:0.5;}
    .player, .obstacle, .note {
      position:absolute; width:100px; text-align:center;
      image-rendering:pixelated;
    }
    .player { bottom:80px; left:200px; font-size:64px; }
    .obstacle { font-size:64px; color:#f00; }
    .note { font-size:48px; color:#ff0; }
    @keyframes fall {0%{top:-60px}100%{top:920px}}
    .falling { animation:fall linear forwards; }
    #scoreboard { position:absolute; top:8px; left:8px; font-size:16px; }
    #message,#victory { position:absolute; top:40%; width:100%; font-size:24px; display:none; }
    #victoryEmoji { font-size:36px; margin-top:10px; display:flex; justify-content:center; gap:5px; }
    #restartBtn {
      display:none; position:absolute; top:60%; left:50%; transform:translateX(-50%);
      padding:12px 24px; font-size:18px;
    }
    .controls{ display:none; position:absolute; bottom:20px; width:100%; text-align:center; }
    .btn{ font-size:24px; padding:8px 16px; background:#0f0; color:#000; }
    @media(max-width:600px){.controls{display:block;}}
  </style>
</head>
<body>
  <div id="startScreen">
    <p>üé∂ –°–æ–±–µ—Ä–∏ –Ω–æ—Ç–∫–∏, –∏–∑–±–µ–≥–∞–π –¥–æ–º–æ–≤! üé∂</p>
    <p>–£–ø—Ä–∞–≤–ª—è–π —Å—Ç—Ä–µ–ª–æ—á–∫–∞–º–∏ ‚óÄÔ∏è‚ñ∂Ô∏è</p>
    <button id="startBtn">‚ñ∂Ô∏è –ü–£–°–ö</button>
  </div>

  <div id="game">
    <div class="player" id="player">üï∫</div>
    <div id="message">üò¢ –¢—ã –Ω–µ —É—Å–ø–µ–ª –Ω–∞ –¥–∏—Å–∫–æ—Ç–µ–∫—É!</div>
    <div id="victory">üéâ –£—Å–ø–µ–ª!<div id="victoryEmoji">üï∫üíÉüé∂ü™©üî•</div></div>
    <div id="scoreboard">–ù–æ—Ç—ã: 0¬†| –£—Ä–æ–≤–µ–Ω—å:¬†1</div>
    <button id="restartBtn">üîÑ –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
    <div class="controls">
      <button class="btn" id="leftBtn">‚óÄÔ∏è</button>
      <button class="btn" id="rightBtn">‚ñ∂Ô∏è</button>
    </div>
  </div>

  <!-- –ù–∞–±–æ—Ä –∑–≤—É–∫–æ–≤ –¥–ª—è –Ω–æ—Ç -->
  <audio id="note1" src="–æ–ø.mp3" preload="auto"></audio>
  <audio id="note2" src="—Å–∏.mp3" preload="auto"></audio>
  

  <audio id="sfx-fail" src="–±—É–º.mp3" preload="auto"></audio>
  <audio id="sfx-win" src="win.mp3" preload="auto"></audio>

<script>
  const sfxNotes = [
    document.getElementById('note1'),
    document.getElementById('note2')
  ];
  let noteIndex = 0;
  function playNextNoteSound(){
    const snd = sfxNotes[noteIndex];
    snd.currentTime = 0;
    snd.play();
    noteIndex = (noteIndex + 1) % sfxNotes.length;
  }

  const sfxFail = document.getElementById('sfx-fail');
  const sfxWin = document.getElementById('sfx-win');
  const game = document.getElementById('game');
  const player = document.getElementById('player');
  const message = document.getElementById('message');
  const victory = document.getElementById('victory');
  const scoreboard = document.getElementById('scoreboard');
  const restartBtn = document.getElementById('restartBtn');
  const leftBtn = document.getElementById('leftBtn');
  const rightBtn = document.getElementById('rightBtn');

  const step = 100, maxSteps = 5, winScore = 30;
  let playerX = 200, gameOver = false, score = 0, level = 1;
  let fallSpeed = 2, obstacleInterval = 600;
  let obstacleSpawner, noteSpawner, recentLanes = [];

  document.getElementById('startBtn').onclick = () => {
    document.getElementById('startScreen').style.display = 'none';
    initGame();
  };

  function initGame(){
    for(let i=1;i<maxSteps;i++){
      const ln = document.createElement('div');
      ln.className = 'lane';
      ln.style.left = `${i * step}px`;
      game.appendChild(ln);
    }
    listenControls();
    updateScore();
    spawnLoops();
    game.style.display = 'block';
  }

  function listenControls(){
    document.addEventListener('keydown', e => {
      if(gameOver) return;
      if(e.key==='ArrowLeft' && playerX>0) move(-step);
      if(e.key==='ArrowRight' && playerX<step*(maxSteps-1)) move(step);
    });
    leftBtn.onclick = ()=>!gameOver&&playerX>0&&move(-step);
    rightBtn.onclick = ()=>!gameOver&&playerX<step*(maxSteps-1)&&move(step);
  }

  function move(delta){
    playerX += delta;
    player.style.left = playerX + 'px';
  }

  function updateScore(){
    scoreboard.textContent = `–ù–æ—Ç—ã: ${score}¬†| –£—Ä–æ–≤–µ–Ω—å:¬†${level}`;
  }

  function createObstacle(){
    if(gameOver) return;
    const obs = document.createElement('div');
    obs.className = 'obstacle falling';
    obs.textContent = 'üè†';
    const lane = Math.floor(Math.random()*maxSteps);
    obs.style.left = `${lane * step}px`;
    obs.style.animationDuration = `${fallSpeed}s`;
    game.appendChild(obs);
    recentLanes.push(lane);
    if(recentLanes.length>5) recentLanes.shift();
    const chk = setInterval(()=>{
      const t = obs.offsetTop, l = obs.offsetLeft;
      const pt = player.offsetTop, ph = player.offsetHeight;
      if(Math.abs(l-playerX)<40 && t+50>pt && t<pt+ph){
        clearInterval(chk); sfxFail.play(); endGame(false);
      }
      if(t>900){ clearInterval(chk); obs.remove(); }
    },30);
  }

  function createNote(){
    if(gameOver) return;
    let lane, attempts=0;
    do {
      lane = Math.floor(Math.random()*maxSteps);
      attempts++;
    } while(recentLanes.includes(lane) && attempts<10);
    const note = document.createElement('div');
    note.className = 'note falling';
    note.textContent = 'üéµ';
    note.style.left = `${lane * step}px`;
    note.style.animationDuration = `${fallSpeed}s`;
    game.appendChild(note);
    const chk = setInterval(() => {
      const t = note.offsetTop, l = note.offsetLeft;
      const pt = player.offsetTop, ph = player.offsetHeight;
      if(Math.abs(l-playerX)<50 && t+40>pt && t<pt+ph){
        clearInterval(chk); note.remove();
        score++; updateScore();
        playNextNoteSound();
        if(score>=winScore){ sfxWin.play(); endGame(true); }
        else if(score>0 && score%10===0) levelUp();
      }
      if(t>900){ clearInterval(chk); note.remove(); }
    },30);
  }

  function levelUp(){
    level++; updateScore();
    fallSpeed = Math.max(0.3, fallSpeed - 0.2);
    obstacleInterval = Math.max(200, obstacleInterval - 80);
    clearInterval(obstacleSpawner); clearInterval(noteSpawner);
    spawnLoops();
  }

  function spawnLoops(){
    obstacleSpawner = setInterval(createObstacle, obstacleInterval);
    noteSpawner = setInterval(createNote, obstacleInterval * 1.5);
  }

  function endGame(win){
    gameOver = true;
    clearInterval(obstacleSpawner); clearInterval(noteSpawner);
    document.querySelectorAll('.falling').forEach(el=>el.style.animationPlayState='paused');
    if(win) victory.style.display='block';
    else message.style.display='block';
    restartBtn.style.display='block';
  }

  restartBtn.onclick = () => {
    document.querySelectorAll('.obstacle, .note').forEach(el=>el.remove());
    playerX = 200; player.style.left = '200px';
    gameOver=false; score=0; level=1; fallSpeed=2; obstacleInterval=600;
    recentLanes = [];
    message.style.display='none'; victory.style.display='none';
    restartBtn.style.display='none';
    updateScore();
    spawnLoops();
  };
</script>
</body>
</html>
